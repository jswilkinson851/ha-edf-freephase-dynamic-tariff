# EDF FreePhase Dynamic Tariff â€” Entities Documentation (v0.6.0)

This document describes all entities created by the **EDF FreePhase Dynamic Tariff** integration as of **v0.6.0**.

The integration now includes:
- A main data coordinator (EDFCoordinator)
- A cost engine (CostCoordinator)
- A binary sensor platform
- A debug logging switch
- Expanded diagnostics and metadata

All prices use **p/kWh** unless stated otherwise.  
All cost values use **GBP (Â£)**.  
All timestamps use **ISO 8601**.

---

# ðŸ“˜ Overview of Entity Types

The integration exposes:

- **Pricing sensors** (current price, next slot, cheapest/most expensive)
- **Cost sensors** (today, yesterday, perâ€‘slot, perâ€‘phase)
- **Slot & block sensors** (current block, next block, next green/amber/red)
- **Binary sensors** (is the current slot green?)
- **Debug sensors** (debug enabled, debug buffers)
- **Health & metadata sensors** (API latency, coordinator status, last updated)
- **Scheduler timing sensors** (next refresh time)

---

# ðŸ”¹ Pricing Sensors

## **Current Price**
**Entity ID:** `sensor.current_price`  
Shows the price of the current halfâ€‘hour slot.

**Attributes include:**
- start  
- end  
- duration_minutes  
- price_p_per_kwh  
- price_gbp_per_kwh  
- phase  
- icon  

---

## **Next Slot Price**
**Entity ID:** `sensor.edf_freephase_dynamic_next_slot_price`  
Shows the price of the next halfâ€‘hour slot.

---

## **Cheapest Slot (Next 24 Hours)**
**Entity ID:** `sensor.edf_freephase_dynamic_cheapest_slot_next_24_hours`  
Shows the cheapest slot in the next 24 hours.

---

## **Most Expensive Slot (Next 24 Hours)**
**Entity ID:** `sensor.edf_freephase_dynamic_most_expensive_slot_next_24_hours`  
Shows the most expensive slot in the next 24 hours.

---

---

# ðŸ”¹ Standing Charge Sensor (NEW in v0.7.0)

## **Standing Charge**
**Entity ID:** `sensor.standing_charge`  
Shows the daily standing charge for your region (inc VAT), in **p/day**.

**Attributes include:**
- inc_vat_p_per_day  
- exc_vat_p_per_day  
- gbp_per_day  
- valid_from  
- valid_to  
- raw (full EDF API response)  
- region  
- status (ok / missing / error)  

---

# ðŸ”¹ Cost Sensors (Updated in v0.6.1)

The following additional fields are now included in cost summaries:

### **New perâ€‘period attributes:**
- `standing_charge_inc_vat`
- `standing_charge_exc_vat`
- `standing_charge_valid_from`
- `standing_charge_valid_to`
- `standing_charge_cost_gbp`
- `total_cost_including_standing_gbp`

These appear in:
- `sensor.edf_freephase_dynamic_cost_today`  
- `sensor.edf_freephase_dynamic_cost_yesterday`  
- `sensor.edf_freephase_dynamic_cost_per_slot`  
- `sensor.edf_freephase_dynamic_cost_per_phase`  

---

# ðŸ”¹ Health & Metadata Sensors (Updated)

## **Coordinator Status**
Now includes standingâ€‘charge heartbeat flags:
- `standing_charge_error`
- `standing_charge_missing`

---

# ðŸ”¹ Cost Sensors (NEW in v0.6.0)

These sensors use your **electricity import sensor** to calculate realâ€‘world costs.

## **Cost Today**
**Entity ID:** `sensor.edf_freephase_dynamic_cost_today`  
Total cost from midnight to now.

---

## **Cost Yesterday**
**Entity ID:** `sensor.edf_freephase_dynamic_cost_yesterday`  
Total cost for the previous day.

---

## **Cost Per Slot** (optional)
**Entity ID:** `sensor.edf_freephase_dynamic_cost_per_slot`  
Breakdown of cost per halfâ€‘hour slot.

---

## **Cost Per Phase** (optional)
**Entity ID:** `sensor.edf_freephase_dynamic_cost_per_phase`  
Cost grouped by phase (green/amber/red).

---

# ðŸ”¹ Slot & Block Sensors

## **Current Block Summary**
**Entity ID:** `sensor.current_block_summary`  
Shows the merged block of consecutive slots with the same phase.

---

## **Next Block Summary**
**Entity ID:** `sensor.next_block_summary`  
Shows the next upcoming block of a different phase.

---

## **Next Green Slot**
**Entity ID:** `sensor.edf_freephase_dynamic_next_green_slot`  

## **Next Amber Slot**
**Entity ID:** `sensor.edf_freephase_dynamic_next_amber_slot`  

## **Next Red Slot**
**Entity ID:** `sensor.edf_freephase_dynamic_next_red_slot`  

Each shows the next slot of that colour.

---

# ðŸ”¹ Daily Summary Sensors

## **Todayâ€™s Rates Summary**
**Entity ID:** `sensor.today_s_rates_summary`  
Shows todayâ€™s merged phase windows.

---

## **Tomorrowâ€™s Rates Summary**
**Entity ID:** `sensor.tomorrow_s_rates_summary`  
Shows tomorrowâ€™s merged phase windows.

---

## **Yesterdayâ€™s Phases Summary**
**Entity ID:** `sensor.yesterday_phases_summary`  
Shows yesterdayâ€™s merged phase windows.

---

# ðŸ”¹ Binary Sensors (NEW)

## **Is Current Slot Green?**
**Entity ID:**  
`binary_sensor.edf_freephase_dynamic_is_green_slot`

True when the current slot is green.

---

# ðŸ”¹ Debug Sensors (NEW)

## **Debug Logging Enabled**
**Entity ID:**  
`sensor.edf_freephase_dynamic_debug_logging_enabled`

Reflects the state of the debug logging switch.

---

## **EDFCoordinator Debug Buffer**
**Entity ID:**  
`sensor.edf_freephase_dynamic_ec_debug_buffer`

Shows the last 10 debug messages from the main coordinator.

---

## **CostCoordinator Debug Buffer**
**Entity ID:**  
`sensor.edf_freephase_dynamic_cc_debug_buffer`

Shows the last 10 debug messages from the cost engine.

---

# ðŸ”¹ Scheduler & Timing Sensors

## **Next Refresh Time**
**Entity ID:**  
`sensor.edf_freephase_dynamic_next_refresh_time`

Shows when the next aligned refresh will occur.

---

# ðŸ”¹ Health & Metadata Sensors

## **Coordinator Status**
**Entity ID:** `sensor.coordinator_status`  
Shows the overall health state:
- healthy  
- partial  
- stale  
- api_error  
- parsing_error  
- scheduler_error  
- etc.

---

## **API Latency**
**Entity ID:** `sensor.api_latency`  
Roundâ€‘trip time to the EDF API.

---

## **Last Updated**
**Entity ID:** `sensor.last_updated`  
When the coordinator last ran.

---

## **Last Successful Update**
**Entity ID:** `sensor.last_successful_update`  
When fresh data was last retrieved.

---

## **Data Age**
**Entity ID:** `sensor.data_age`  
Seconds since the last successful update.

---

## **Tariff Metadata**
Available in diagnostics:
- tariff_metadata  
- tariff_region_label  
- product_url  
- api_url  

---