# ðŸ”” Tariff Slot & Phase Events

As of **v0.7.0**, this integration includes a full **event platform** that emits structured Home Assistant events whenever EDFâ€™s dynamic tariff changes in a meaningful way.

These events allow you to build automations that react instantly to:
- slot changes  
- phase changes (green/amber/red)  
- block transitions  
- nextâ€‘phase predictions  
- tariff window boundaries  

---

# ðŸ“¡ Event Entity

### `event.tariff_slot_phase_events`

This entity emits all tariffâ€‘related events.  
It also exposes diagnostics attributes:

- `last_event_type`
- `last_event_timestamp`
- `event_counts`
- `event_history`

---

# ðŸ§™â€â™‚ï¸ Event Types

The following events may be emitted:

| Event Type | Description |
|------------|-------------|
| `edf_fpd_slot_changed` | The current halfâ€‘hour slot changed. |
| `edf_fpd_phase_changed` | The tariff phase (green/amber/red) changed. |
| `edf_fpd_phase_started` | A new phase window began. |
| `edf_fpd_phase_ended` | A phase window ended. |
| `edf_fpd_phase_block_changed` | The merged block (group of sameâ€‘colour slots) changed. |
| `edf_fpd_next_phase_changed` | The predicted next phase changed. |
| `edf_fpd_next_green_phase_changed` | The next green phase changed. |
| `edf_fpd_next_amber_phase_changed` | The next amber phase changed. |
| `edf_fpd_next_red_phase_changed` | The next red phase changed. |

---

# ðŸ“¦ Event Payload Structure

Each event includes a structured JSON payload.  
Example fields include:

```json
{
  "event_type": "edf_fpd_phase_changed",
  "timestamp": "2026-01-25T20:00:03.050683+00:00",
  "phase": "amber",
  "from": {
    "phase": "green",
    "start": "19:30"
  },
  "to": {
    "phase": "amber",
    "start": "20:00"
  }
}
```

Payloads may include:

- `phase`
- `from` / `to` objects
- slot boundaries
- block summaries
- price information
- timestamps

---

## ðŸ§ª Example Automations

### Notify when a new phase starts

```yaml
alias: Notify on new tariff phase
trigger:
  - platform: event
    event_type: edf_fpd_phase_started
action:
  - service: notify.mobile_app_phone
    data:
      message: >
        New tariff phase started: {{ trigger.event.data.phase }}
```

### Trigger when the next green window becomes available

```yaml
alias: Prepare for next green window
trigger:
  - platform: event
    event_type: edf_fpd_next_green_phase_changed
action:
  - service: script.prepare_for_green_window
```