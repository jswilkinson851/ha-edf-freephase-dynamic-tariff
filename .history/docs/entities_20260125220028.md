# EDF FreePhase Dynamic Tariff â€” Entities Documentation (v0.6.0)

This document describes all entities created by the **EDF FreePhase Dynamic Tariff** integration as of **v0.6.0**.

The integration now includes:
- A main data coordinator (EDFCoordinator)
- A cost engine (CostCoordinator)
- A binary sensor platform
- A debug logging switch
- Expanded diagnostics and metadata

All prices use **p/kWh** unless stated otherwise.  
All cost values use **GBP (Â£)**.  
All timestamps use **ISO 8601**.

---

# ğŸ“˜ Overview of Entity Types

The integration exposes:

- **Pricing sensors** (current price, next slot, cheapest/most expensive)
- **Cost sensors** (today, yesterday, perâ€‘slot, perâ€‘phase)
- **Slot & block sensors** (current block, next block, next green/amber/red)
- **Binary sensors** (is the current slot green?)
- **Debug sensors** (debug enabled, debug buffers)
- **Health & metadata sensors** (API latency, coordinator status, last updated)
- **Scheduler timing sensors** (next refresh time)

---

# ğŸ”¹ Pricing Sensors

## **Current Price**
**Entity ID:** `sensor.current_price`  
Shows the price of the current halfâ€‘hour slot.

**Attributes include:**
- start  
- end  
- duration_minutes  
- price_p_per_kwh  
- price_gbp_per_kwh  
- phase  
- icon  

---

## **Next Slot Price**
**Entity ID:** `sensor.edf_freephase_dynamic_next_slot_price`  
Shows the price of the next halfâ€‘hour slot.

---

## **Cheapest Slot (Next 24 Hours)**
**Entity ID:** `sensor.edf_freephase_dynamic_cheapest_slot_next_24_hours`  
Shows the cheapest slot in the next 24 hours.

---

## **Most Expensive Slot (Next 24 Hours)**
**Entity ID:** `sensor.edf_freephase_dynamic_most_expensive_slot_next_24_hours`  
Shows the most expensive slot in the next 24 hours.

---

---

# ğŸ”¹ Standing Charge Sensor (NEW in v0.6.1)

## **Standing Charge**
**Entity ID:** `sensor.standing_charge`  
Shows the daily standing charge for your region (inc VAT), in **p/day**.

**Attributes include:**
- inc_vat_p_per_day  
- exc_vat_p_per_day  
- gbp_per_day  
- valid_from  
- valid_to  
- raw (full EDF API response)  
- region  
- status (ok / missing / error)  

---

# ğŸ”¹ Cost Sensors (Updated in v0.6.1)

The following additional fields are now included in cost summaries:

### **New perâ€‘period attributes:**
- `standing_charge_inc_vat`
- `standing_charge_exc_vat`
- `standing_charge_valid_from`
- `standing_charge_valid_to`
- `standing_charge_cost_gbp`
- `total_cost_including_standing_gbp`

These appear in:
- `sensor.edf_freephase_dynamic_cost_today`  
- `sensor.edf_freephase_dynamic_cost_yesterday`  
- `sensor.edf_freephase_dynamic_cost_per_slot`  
- `sensor.edf_freephase_dynamic_cost_per_phase`  

---

# ğŸ”¹ Health & Metadata Sensors (Updated)

## **Coordinator Status**
Now includes standingâ€‘charge heartbeat flags:
- `standing_charge_error`
- `standing_charge_missing`

---

# ğŸ”¹ Cost Sensors (NEW in v0.6.0)

These sensors use your **electricity import sensor** to calculate realâ€‘world costs.

## **Cost Today**
**Entity ID:** `sensor.edf_freephase_dynamic_cost_today`  
Total cost from midnight to now.

---

## **Cost Yesterday**
**Entity ID:** `sensor.edf_freephase_dynamic_cost_yesterday`  
Total cost for the previous day.

---

## **Cost Per Slot** (optional)
**Entity ID:** `sensor.edf_freephase_dynamic_cost_per_slot`  
Breakdown of cost per halfâ€‘hour slot.

---

## **Cost Per Phase** (optional)
**Entity ID:** `sensor.edf_freephase_dynamic_cost_per_phase`  
Cost grouped by phase (green/amber/red).

---

# ğŸ”¹ Slot & Block Sensors

## **Current Block Summary**
**Entity ID:** `sensor.current_block_summary`  
Shows the merged block of consecutive slots with the same phase.

---

## **Next Block Summary**
**Entity ID:** `sensor.next_block_summary`  
Shows the next upcoming block of a different phase.

---

## **Next Green Slot**
**Entity ID:** `sensor.edf_freephase_dynamic_next_green_slot`  

## **Next Amber Slot**
**Entity ID:** `sensor.edf_freephase_dynamic_next_amber_slot`  

## **Next Red Slot**
**Entity ID:** `sensor.edf_freephase_dynamic_next_red_slot`  

Each shows the next slot of that colour.

---

# ğŸ”¹ Daily Summary Sensors

## **Todayâ€™s Rates Summary**
**Entity ID:** `sensor.today_s_rates_summary`  
Shows todayâ€™s merged phase windows.

---

## **Tomorrowâ€™s Rates Summary**
**Entity ID:** `sensor.tomorrow_s_rates_summary`  
Shows tomorrowâ€™s merged phase windows.

---

## **Yesterdayâ€™s Phases Summary**
**Entity ID:** `sensor.yesterday_phases_summary`  
Shows yesterdayâ€™s merged phase windows.

---

# ğŸ”¹ Binary Sensors (NEW)

## **Is Current Slot Green?**
**Entity ID:**  
`binary_sensor.edf_freephase_dynamic_is_green_slot`

True when the current slot is green.

---

# ğŸ”¹ Debug Sensors (NEW)

## **Debug Logging Enabled**
**Entity ID:**  
`sensor.edf_freephase_dynamic_debug_logging_enabled`

Reflects the state of the debug logging switch.

---

## **EDFCoordinator Debug Buffer**
**Entity ID:**  
`sensor.edf_freephase_dynamic_ec_debug_buffer`

Shows the last 10 debug messages from the main coordinator.

---

## **CostCoordinator Debug Buffer**
**Entity ID:**  
`sensor.edf_freephase_dynamic_cc_debug_buffer`

Shows the last 10 debug messages from the cost engine.

---

# ğŸ”¹ Scheduler & Timing Sensors

## **Next Refresh Time**
**Entity ID:**  
`sensor.edf_freephase_dynamic_next_refresh_time`

Shows when the next aligned refresh will occur.

---

# ğŸ”¹ Health & Metadata Sensors

## **Coordinator Status**
**Entity ID:** `sensor.coordinator_status`  
Shows the overall health state:
- healthy  
- partial  
- stale  
- api_error  
- parsing_error  
- scheduler_error  
- etc.

---

## **API Latency**
**Entity ID:** `sensor.api_latency`  
Roundâ€‘trip time to the EDF API.

---

## **Last Updated**
**Entity ID:** `sensor.last_updated`  
When the coordinator last ran.

---

## **Last Successful Update**
**Entity ID:** `sensor.last_successful_update`  
When fresh data was last retrieved.

---

## **Data Age**
**Entity ID:** `sensor.data_age`  
Seconds since the last successful update.

---

## **Tariff Metadata**
Available in diagnostics:
- tariff_metadata  
- tariff_region_label  
- product_url  
- api_url  

---

# ğŸ“¦ Entities

This integration exposes a set of entities that provide live tariff data, cost information, standing charges, slot/phase summaries, health diagnostics, and now (as of **v0.7.0**) a full **event entity** for reacting to tariff transitions in real time.

Below is a complete list of all entities grouped by platform.

---

## âš¡ Sensor Entities

### `sensor.current_price`
Current halfâ€‘hourly unit rate (p/kWh).

### `sensor.next_slot_price`
Unit rate for the next halfâ€‘hourly slot.

### `sensor.cheapest_slot_next_24h`
Cheapest slot in the next 24 hours.

### `sensor.most_expensive_slot_next_24h`
Most expensive slot in the next 24 hours.

### `sensor.standing_charge`
Standing charge (p/day, inc VAT).  
Attributes include:
- exc VAT  
- GBP/day  
- validity dates  
- raw EDF API data  

### Cost Sensors
- `sensor.cost_today`
- `sensor.cost_yesterday`
- `sensor.cost_per_slot`
- `sensor.cost_per_phase`
- `sensor.total_cost_including_standing`

These sensors use your import meter to calculate accurate realâ€‘world costs.

### Slot & Block Sensors
- `sensor.current_slot_colour`
- `sensor.current_block_summary`
- `sensor.next_block_summary`
- `sensor.next_green_slot`
- `sensor.next_amber_slot`
- `sensor.next_red_slot`

---

## ğŸ”‹ Binary Sensors

### `binary_sensor.is_green_slot`
Indicates whether the current slot is classified as **green**.

---

## ğŸ›  Debug & Health Sensors

### `sensor.next_refresh_time`
Shows the next scheduled refresh time, jitter, and interval.

### `sensor.debug_logging_enabled`
Reflects the state of the debug logging switch.

### `sensor.diagnostic_sensor`
A comprehensive diagnostic entity exposing:
- API latency  
- heartbeat flags  
- scheduler timing  
- slot/phase summaries  
- tariff metadata  
- debug logs  
- standingâ€‘charge diagnostics  
- **event diagnostics (NEW in v0.7.0)**:
  - `last_event_type`
  - `last_event_timestamp`
  - `event_counts`
  - `event_history`

---

## ğŸ§™â€â™‚ï¸ Event Entities (NEW in v0.7.0)

### `event.tariff_slot_phase_events`

A dedicated event entity that emits structured events whenever the tariff changes in a meaningful way.

This entity emits:

- `edf_fpd_slot_changed`
- `edf_fpd_phase_changed`
- `edf_fpd_phase_started`
- `edf_fpd_phase_ended`
- `edf_fpd_phase_block_changed`
- `edf_fpd_next_phase_changed`
- `edf_fpd_next_green_phase_changed`
- `edf_fpd_next_amber_phase_changed`
- `edf_fpd_next_red_phase_changed`

#### Attributes
- `last_event_type`  
- `last_event_timestamp`  
- `event_counts` (perâ€‘type counters)  
- `event_history` (chronological, structured, inâ€‘memory)

#### Notes
- Event history is retained in memory only (not persisted).  
- The entity attaches to the same device as all other integration entities.  
- Events are emitted immediately when the coordinator detects a transition.

---

## ğŸ§¹ Switches

### `switch.debug_logging`
Enables or disables structured debug logging without restarting Home Assistant.

---

## ğŸ“Œ Summary

This integration provides a complete set of tariff, cost, diagnostic, and eventâ€‘driven entities designed for dashboards, automations, and advanced energy management workflows.

---