# ==============================================================================
# EDF FreePhase Dynamic ‚Äî Full Tariff & Diagnostics Dashboard
# ==============================================================================

views:
  - type: sections
    path: edf-freephase-dynamic-dash
    title: EDF FreePhase Dynamic Dash
    icon: mdi:truck-snowflake
    cards: []
    sections:
      - type: grid
        cards:
          - type: custom:mod-card
            card:
              type: custom:layout-card
              layout_type: custom:vertical-layout
              cards:

                # ---------------------------------------------------------
                # Coordinator & System
                # ---------------------------------------------------------
                - type: custom:expander-card
                  title: üß≠ Coordinator & System
                  default_open: true
                  cards:
                    - type: entities
                      entities:
                        - type: attribute
                          entity: sensor.edf_fpd_diagnostic
                          attribute: integration_version
                          name: Integration Version
                        - entity: sensor.edf_fpd_cost_coordinator_status
                        - entity: sensor.edf_fpd_diagnostic
                          name: Diagnostic Status
                        - entity: sensor.edf_fpd_tariff_metadata
                        - entity: sensor.edf_fpd_last_updated
                        - entity: sensor.edf_fpd_next_refresh_time
                        - entity: sensor.edf_fpd_api_latency

                # ---------------------------------------------------------
                # Current State
                # ---------------------------------------------------------
                - type: custom:expander-card
                  title: üìç Current State
                  default_open: true
                  cards:
                    - type: entities
                      entities:
                        - entity: sensor.edf_fpd_current_price
                        - entity: sensor.edf_fpd_current_phase_summary
                        - entity: sensor.edf_fpd_current_slot_colour
                        - entity: binary_sensor.edf_fpd_is_green_slot

                # ---------------------------------------------------------
                # Next State
                # ---------------------------------------------------------
                - type: custom:expander-card
                  title: ‚è≠Ô∏è Next State
                  default_open: true
                  cards:
                    - type: entities
                      entities:
                        - entity: sensor.edf_fpd_next_slot_price
                        - entity: sensor.edf_fpd_next_phase_summary
                        - entity: sensor.edf_fpd_next_green_slot
                        - entity: sensor.edf_fpd_next_amber_slot
                        - entity: sensor.edf_fpd_next_red_slot

                # ---------------------------------------------------------
                # Price Extremes
                # ---------------------------------------------------------
                - type: custom:expander-card
                  title: üìä Price Extremes (Next 24 Hours)
                  default_open: true
                  cards:
                    - type: entities
                      entities:
                        - entity: sensor.edf_fpd_cheapest_slot
                        - entity: sensor.edf_fpd_most_expensive_slot

                # ---------------------------------------------------------
                # Daily Summaries
                # ---------------------------------------------------------
                - type: custom:expander-card
                  title: üìÖ Daily Summaries
                  default_open: true
                  cards:
                    - type: entities
                      entities:
                        - entity: sensor.edf_fpd_yesterday_phases_summary
                        - entity: sensor.edf_fpd_today_phases_summary
                        - entity: sensor.edf_fpd_tomorrow_phases_summary

                # ---------------------------------------------------------
                # Daily Costs
                # ---------------------------------------------------------
                - type: custom:expander-card
                  title: üí∑ Daily Costs
                  default_open: true
                  cards:
                    - type: entities
                      entities:
                        - entity: sensor.edf_fpd_cost_per_phase
                          name: Today ‚Äì Cost (by Phase)
                        - entity: sensor.edf_fpd_cost_per_slot
                          name: Today ‚Äì Cost (by Slots)
                        - entity: sensor.edf_fpd_cost_yesterday
                          name: Yesterday ‚Äì Total Cost

      # ---------------------------------------------------------
      # Right-hand diagnostic panel
      # ---------------------------------------------------------
      - type: grid
        cards:
          - type: vertical-stack
            cards:

              - type: horizontal-stack
                cards:
                  - type: entity
                    entity: sensor.edf_fpd_cost_coordinator_status
                    name: Cost Pipeline
                  - type: entity
                    entity: sensor.edf_fpd_diagnostic
                    attribute: integration_version
                    name: Version

              - type: entities
                entities:
                  - entity: switch.edf_fpd_debug_logging
                    name: Debug Logging

              - type: entities
                title: Live Status
                entities:
                  - type: custom:multiple-entity-row
                    entity: sensor.edf_fpd_diagnostic
                    name: API Latency (ms)
                    attribute: api_latency_ms
                  - type: custom:multiple-entity-row
                    entity: sensor.edf_fpd_diagnostic
                    name: Last Updated
                    attribute: last_updated
                  - type: custom:multiple-entity-row
                    entity: sensor.edf_fpd_diagnostic
                    name: Next Refresh
                    attribute: next_refresh_datetime
                  - type: custom:multiple-entity-row
                    entity: sensor.edf_fpd_diagnostic
                    name: Refresh Delay (s)
                    attribute: next_refresh_delay
                  - type: custom:multiple-entity-row
                    entity: sensor.edf_fpd_diagnostic
                    name: Refresh Jitter (s)
                    attribute: next_refresh_jitter

              - type: custom:mushroom-entity-card
                entity: sensor.edf_fpd_diagnostic
                name: Current Tariff Slot
                icon: mdi:clock-outline
                layout: vertical

              - type: entities
                title: Current Tariff Slot
                entities:
                  - type: attribute
                    entity: sensor.edf_fpd_diagnostic
                    attribute: current_slot
                    name: Current Slot
                  - type: attribute
                    entity: sensor.edf_fpd_diagnostic
                    attribute: current_phase_summary
                    name: Current Phase Summary

              - type: custom:expander-card
                title: Advanced Diagnostics
                padding: 12
                cards:
                  - type: entities
                    entities:
                      - entity: sensor.edf_fpd_diagnostic
                      - entity: sensor.edf_fpd_cost_coordinator_status
                      - type: attribute
                        entity: sensor.edf_fpd_diagnostic
                        attribute: api_latency_ms
                        name: API Latency (ms)
                      - type: attribute
                        entity: sensor.edf_fpd_diagnostic
                        attribute: next_refresh_datetime
                        name: Next Refresh
                      - type: attribute
                        entity: sensor.edf_fpd_diagnostic
                        attribute: next_refresh_delay
                        name: Refresh Delay (s)
                      - type: attribute
                        entity: sensor.edf_fpd_diagnostic
                        attribute: next_refresh_jitter
                        name: Refresh Jitter (s)
                      - type: attribute
                        entity: sensor.edf_fpd_diagnostic
                        attribute: current_slot
                        name: Current Slot
                      - type: attribute
                        entity: sensor.edf_fpd_diagnostic
                        attribute: current_phase_summary
                        name: Current Phase Summary

    max_columns: 4
